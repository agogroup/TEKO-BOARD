# TEKO-BOARD 要件定義書

**バージョン**: 1.0
**作成日**: 2025年12月17日
**最終更新**: 2025年12月17日

---

## 1. プロジェクト概要

### 1.1 目的

TEKO-BOARDは、UGOKU株式会社のTEKO事業（軽作業人材派遣）における人員配置管理システムです。
「誰がどの現場にいるか」を一目で把握し、配車の効率化と情報共有の迅速化を実現します。

### 1.2 背景・課題

| 課題 | 詳細 |
|------|------|
| **人員配置の不可視** | 誰がどの現場にいるか一覧で把握できない。Googleカレンダー頼りでバッティングが発生 |
| **TEKO配車の非効率** | 工程表を見て「いつゴミが出るか」を人が判断。複数現場のルート最適化ができていない |
| **情報共有の遅延** | 現場状況がリアルタイムで伝わらない |
| **連絡先の散在** | 職人・業者の連絡先が個人のスマホに分散 |

### 1.3 期待する効果

- 全関係者の動きを一画面で把握（CTI機能）
- TEKO配車の判断時間短縮
- 現場状況の可視化
- 連絡先の一元管理

### 1.4 関連システム

- **AGORA**: AGOグループの現場管理システム（同一Supabaseを共有）
- **同一Supabase**: `https://aotzgiaefbvbqhrguqdg.supabase.co`

---

## 2. ユーザーストーリー

### 2.1 菅野隆太（社長）として

| ID | ストーリー | 優先度 |
|----|----------|--------|
| US-001 | 全現場・全人員の動きを一覧で把握したい | 必須 |
| US-002 | 「暇な人」が一目でわかるようにしたい | 必須 |
| US-003 | バッティング（作業の競合）を事前に防ぎたい | 必須 |

### 2.2 染谷雅人（TEKO現場管理）として

| ID | ストーリー | 優先度 |
|----|----------|--------|
| US-010 | 今日・明日のTEKO配車予定を一覧で見たい | 必須 |
| US-011 | 各現場のゴミ発生タイミングを把握したい | 重要 |
| US-012 | 他の業者（三十興業等）の動きも確認したい | 必須 |

### 2.3 菅優伍（TEKOデスク管理）として

| ID | ストーリー | 優先度 |
|----|----------|--------|
| US-020 | 全現場の進捗を一目で確認したい | 必須 |
| US-021 | タイムチャートで誰がどこにいるか把握したい | 必須 |
| US-022 | 学習のため、過去の配車履歴を振り返りたい | 重要 |

### 2.4 堀川寿人/トラ（現場管理）として

| ID | ストーリー | 優先度 |
|----|----------|--------|
| US-030 | 自分が担当する現場の工程を確認したい | 必須 |
| US-031 | TEKOや他業者の到着予定を知りたい | 必須 |
| US-032 | 職人への連絡先をすぐ調べたい | 必須 |

### 2.5 梅内光（積算・工程準備）として

| ID | ストーリー | 優先度 |
|----|----------|--------|
| US-040 | 作成した工程表を関係者に共有したい | 重要 |
| US-041 | 工程変更時に関係者へ通知したい | 重要 |
| US-042 | 各業者の空き状況を確認して調整したい | 重要 |

---

## 3. 機能要件

### 3.1 タイムチャート

#### FR-001: 日別タイムチャート表示

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 縦軸に会社/担当者、横軸に時間（0〜24時）でスケジュールを表示 |

**機能詳細:**
- 24時間表示（1時間刻み）
- 横スクロール対応（スマートフォン対応）
- 作業種別ごとの色分け表示
- 現場名・作業種別をセル内に表示
- 現在時刻の縦線表示（当日のみ）

---

#### FR-002: 週間タイムチャート表示

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 縦軸に会社/担当者、横軸に曜日（月〜日）で週間スケジュールを表示 |

**機能詳細:**
- 7日間表示
- 日別ビューとの切り替え
- 現場名・時間帯をセル内に表示

---

#### FR-003: 日付切替

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 表示日付の変更機能 |

**機能詳細:**
- 前日/翌日ボタン
- 日付ピッカー
- 「今日」ボタン
- 週間ビュー時は週単位での切り替え

---

#### FR-004: スケジュール詳細表示

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | スケジュールアイテムをタップで詳細をモーダル表示 |

**表示項目:**
- 現場名
- 住所
- 担当会社/担当者
- 作業種別
- 時間帯
- 備考

---

#### FR-005: ドラッグ&ドロップによるスケジュール編集

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | タイムチャート上でスケジュールをドラッグ&ドロップで編集 |

**機能詳細:**
- アイテム中央ドラッグ: 時間変更 + 別担当者への移動
- アイテム左端ドラッグ: 開始時間変更
- アイテム右端ドラッグ: 終了時間変更
- 15分単位でスナップ
- 日別・週間両ビュー対応

---

#### FR-006: 新規スケジュール追加

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 新規スケジュールの追加フォーム |

**入力項目:**
- 現場（選択）
- 担当会社/担当者（選択）
- 日付
- 開始時間/終了時間
- 作業種別（選択）
- 備考

---

### 3.2 現場管理

#### FR-010: 現場一覧表示

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 進行中の現場を一覧表示 |

**機能詳細:**
- ステータスフィルタ（進行中/予定/完了）
- 現場名検索
- 現場カード表示（名称、住所、ステータス）

---

#### FR-011: 現場詳細表示

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 現場の詳細情報を表示 |

**表示項目:**
- 基本情報（名称、住所、期間）
- 関係者一覧
- スケジュール履歴
- AGORA案件へのリンク（紐付けがある場合）

---

#### FR-012: 現場登録・編集

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 現場情報の登録・編集 |

**入力項目（必須）:**
- 現場名

**入力項目（任意）:**
- 住所
- クライアント（選択、共有テーブル）
- AGORA案件紐付け（選択）
- 備考

---

### 3.3 ワーカー管理

#### FR-020: ワーカー一覧表示

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 職人・作業員の一覧表示 |

**機能詳細:**
- 会社でグループ表示
- スキル（作業種別）でフィルタ
- アクティブ/非アクティブ切り替え

---

#### FR-021: ワーカー登録・編集

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | ワーカー情報の登録・編集 |

**入力項目:**
- 名前（必須）
- 所属会社
- 電話番号
- メールアドレス
- スキル（複数選択）
- 備考
- アクティブフラグ

---

### 3.4 連絡先管理

#### FR-030: 連絡先一覧・検索

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 会社・業者の連絡先一覧と検索 |

**機能詳細:**
- 会社名・担当者名で検索
- カテゴリ（作業種別）でフィルタ
- ワンタップ電話発信

---

#### FR-031: 連絡先登録・編集

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | 連絡先情報の登録・編集 |

**入力項目:**
- 会社名（必須）
- 担当者名
- 電話番号
- メールアドレス
- カテゴリ（作業種別）
- 備考

---

### 3.5 認証・認可

#### FR-040: ログイン

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | Supabase Authによるメール/パスワード認証 |

**機能詳細:**
- AGORAと共通のユーザー認証
- 未認証時は/loginにリダイレクト

---

#### FR-041: Row-Level Security

| 項目 | 内容 |
|------|------|
| 優先度 | 必須 |
| 概要 | RLSによるデータアクセス制御 |

**ポリシー:**
- 認証済みユーザーのみTEKOテーブルにアクセス可能
- 将来的にロールベースの制御を追加予定

---

### 3.6 Phase 2 機能（計画中）

#### FR-050: ゴミ発生タイミング自動算出

| 項目 | 内容 |
|------|------|
| 優先度 | Phase 2 |
| 概要 | 工程から「この日にゴミが出る」を自動表示 |

---

#### FR-051: 配車ルート提案

| 項目 | 内容 |
|------|------|
| 優先度 | Phase 2 |
| 概要 | 複数現場を効率的に回る順序を提案 |

---

#### FR-052: 工程変更通知

| 項目 | 内容 |
|------|------|
| 優先度 | Phase 2 |
| 概要 | 変更時にLINE通知 |

---

#### FR-053: 職人単位への展開

| 項目 | 内容 |
|------|------|
| 優先度 | Phase 2 |
| 概要 | 会社単位 → 個人単位に詳細化 |

---

## 4. データ構造

### 4.1 主要エンティティ

```
[現場 teko_sites]
├── id (UUID)
├── name（現場名）
├── address（住所）
├── client_id（クライアント、共有テーブル参照）
├── project_id（AGORA案件紐付け）
├── notes（備考）
├── is_active（アクティブフラグ）
├── created_at / updated_at

[ワーカー teko_workers]
├── id (UUID)
├── name（名前）
├── company_name（所属会社）
├── phone（電話番号）
├── email（メール）
├── skills[]（スキル、作業種別配列）
├── notes（備考）
├── is_active（アクティブフラグ）
├── created_at / updated_at

[配置スケジュール teko_assignments]
├── id (UUID)
├── worker_id（ワーカー参照）
├── site_id（現場参照）
├── date（日付）
├── start_time / end_time（開始・終了時間）
├── status（ステータス: scheduled/completed/cancelled）
├── notes（備考）
├── created_by（作成者、users参照）
├── created_at / updated_at

[連絡先 teko_contacts]
├── id (UUID)
├── company_name（会社名）
├── contact_name（担当者名）
├── phone（電話番号）
├── email（メール）
├── category（カテゴリ、作業種別）
├── notes（備考）
├── created_at / updated_at
```

### 4.2 作業種別マスタ

| work_type | 表示名 | カラー | ゴミ発生 |
|-----------|--------|--------|----------|
| garbage | ゴミ回収 | #3B82F6 (青) | - |
| management | 現場管理 | #22C55E (緑) | - |
| interior | 内装工事 | #F97316 (オレンジ) | あり |
| demolition | 解体 | #EF4444 (赤) | あり（大量） |
| electrical | 電気工事 | #EAB308 (黄) | 少量 |
| light_steel | 軽量鉄骨 | #F97316 (オレンジ) | あり |
| board | ボード | #F97316 (オレンジ) | あり |
| wallpaper | クロス | #F97316 (オレンジ) | あり |
| tile_carpet | タイルカーペット | #F97316 (オレンジ) | あり |

### 4.3 AGORA連携ポイント

| 連携 | 方法 |
|------|------|
| 現場 → AGORA案件 | `teko_sites.project_id` で紐付け |
| 現場 → クライアント | `teko_sites.client_id` で共有clients参照 |
| 認証 | 同一 `users` テーブル、Supabase Auth共有 |

---

## 5. 非機能要件

### 5.1 性能要件

| 項目 | 要件 |
|------|------|
| タイムチャート表示 | 2秒以内 |
| 検索応答 | 1秒以内 |
| ドラッグ&ドロップ | 遅延なくスムーズに動作 |
| 同時接続ユーザー | 20人以上 |

### 5.2 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働率 | 99.5%以上 |
| 計画停止 | 事前通知24時間以上 |
| バックアップ | 日次自動バックアップ（Supabase） |

### 5.3 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 認証 | Supabase Auth（メール/パスワード） |
| 認可 | Row-Level Security (RLS) |
| 通信 | HTTPS必須 |
| 機密情報 | 債務、契約金額等は含めない |

### 5.4 ユーザビリティ要件

| 項目 | 要件 |
|------|------|
| 主要デバイス | スマートフォン（現場での確認） |
| 副デバイス | PC（事務所での入力・管理） |
| ブラウザ | Chrome, Safari, Edge最新版 |
| 操作性 | ITが苦手な人でも使える直感的なUI |

### 5.5 将来対応（オフライン）

| 項目 | 要件 |
|------|------|
| オフラインキャッシュ | 直近データをキャッシュ表示（理想、Phase 2以降） |

---

## 6. ユーザー種別と権限

### 6.1 ユーザーロール

| ロール | 説明 | 主な利用者 |
|--------|------|-----------|
| admin | システム管理者 | 末武 |
| manager | 管理者 | 菅野社長、染谷、堀川 |
| member | メンバー | TEKO配車担当、現場管理者 |

### 6.2 権限マトリクス

| 機能 | admin | manager | member |
|------|-------|---------|--------|
| タイムチャート閲覧 | O | O | O |
| スケジュール登録・編集 | O | O | O |
| 現場登録・編集 | O | O | O |
| ワーカー登録・編集 | O | O | - |
| 連絡先登録・編集 | O | O | O |
| ユーザー管理 | O | - | - |

---

## 7. 外部インターフェース

### 7.1 認証
- Supabase Auth（AGORAと共有）

### 7.2 データベース
- Supabase（PostgreSQL）（AGORAと同一プロジェクト）

### 7.3 外部API（Phase 2以降）

| サービス | 連携内容 | フェーズ |
|----------|----------|----------|
| LINE | 工程変更通知 | Phase 2 |
| Googleマップ | 現場住所からルート表示 | Phase 2 |

---

## 8. 用語定義

| 用語 | 定義 |
|------|------|
| TEKO | UGOKU株式会社の軽作業人材派遣事業 |
| ワーカー | 配置対象の職人・作業員 |
| 現場（サイト） | 作業を行う場所 |
| 配置（アサインメント） | ワーカーを現場に割り当てること |
| タイムチャート | 縦軸に人員、横軸に時間で配置状況を可視化した図 |
| 作業種別 | ゴミ回収、内装工事、解体等の作業カテゴリ |
| CTI | Computer Telephony Integration の略。本システムでは人員配置可視化機能を指す |

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2025-12-17 | 1.0 | 初版作成 |
