---
description: セキュリティチェック - 認証、RLS、バリデーション、環境変数の確認
---

# セキュリティチェック

TEKO-BOARDのセキュリティ観点でコードをレビューしてください。

## チェック項目

### 1. 認証チェック

以下を確認:
- `src/app/(dashboard)/` 配下のページが認証を要求しているか
- `src/middleware.ts` で未認証ユーザーを `/login` にリダイレクトしているか
- Server Component で `supabase.auth.getUser()` を適切に使用しているか

### 2. Supabase RLS（Row Level Security）

以下を確認:
- データ取得時に適切なフィルタリングがされているか
- RLSポリシーに依存せず、クエリでも `user_id` 等の条件を付けているか
- `teko_*` テーブルへのアクセスが認証ユーザーに限定されているか

### 3. フォームバリデーション

以下を確認:
- `react-hook-form` + `zod` でクライアント側バリデーションがあるか
- Server Actions / API Routes でもサーバー側バリデーションがあるか
- SQLインジェクション対策（Supabaseのパラメータ化クエリを使用しているか）

### 4. 環境変数

以下を確認:
- `NEXT_PUBLIC_` 以外の環境変数がクライアントに露出していないか
- Supabase の `service_role` キーがサーバー側でのみ使用されているか
- `.env` ファイルが `.gitignore` に含まれているか

### 5. API エンドポイント

以下を確認:
- `src/app/api/` 配下のルートで認証チェックがあるか
- レスポンスにセンシティブ情報（パスワード、トークン等）が含まれていないか
- エラーメッセージに内部情報が漏洩していないか

## 出力形式

各項目について以下の形式で報告:

```
## [項目名]

状態: OK / 警告 / 問題あり

該当ファイル:
- path/to/file.ts:行番号 - 説明

推奨対応:
- 具体的な修正内容
```

## 対象

プロジェクト全体をスキャンし、上記の観点で問題箇所を特定してください。
